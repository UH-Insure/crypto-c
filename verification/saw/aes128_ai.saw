print "=== AES-128 ECB (Cryptol Spec Verification) ===";

/* Load AES128 Cryptol module */
cry <- cryptol_load "/work/external/cryptol-specs/Primitive/Symmetric/Cipher/Block/AES/Instantiations/AES128.cry";

/* Extract the encrypt/decrypt functions from the loaded Cryptol module */
encrypt <- cryptol_extract cry "encrypt";
decrypt <- cryptol_extract cry "decrypt";

/* Prove encryption matches NIST SP 800-38A F.2.1 test vectors */
print "Proving AES128 encryption matches NIST vectors...";
prove_print z3 {{ encrypt 0x2b7e151628aed2a6abf7158809cf4f3c 0x6bc1bee22e409f96e93d7e117393172a == 0x3ad77bb40d7a3660a89ecaf32466ef97 }};
prove_print z3 {{ encrypt 0x2b7e151628aed2a6abf7158809cf4f3c 0xae2d8a571e03ac9c9eb76fac45af8e51 == 0xf5d3d58503b9699de785895a96fdbaaf }};
prove_print z3 {{ encrypt 0x2b7e151628aed2a6abf7158809cf4f3c 0x30c81c46a35ce411e5fbc1191a0a52ef == 0x43b1cd7f598ece23881b00e3ed030688 }};
prove_print z3 {{ encrypt 0x2b7e151628aed2a6abf7158809cf4f3c 0xf69f2445df4f9b17ad2b417be66c3710 == 0x7b0c785e27e8ad3f8223207104725dd4 }};

/* Prove decryption reverses the ciphertexts */
print "Proving AES128 decryption reverses ciphertexts...";
prove_print z3 {{ decrypt 0x2b7e151628aed2a6abf7158809cf4f3c 0x3ad77bb40d7a3660a89ecaf32466ef97 == 0x6bc1bee22e409f96e93d7e117393172a }};
prove_print z3 {{ decrypt 0x2b7e151628aed2a6abf7158809cf4f3c 0xf5d3d58503b9699de785895a96fdbaaf == 0xae2d8a571e03ac9c9eb76fac45af8e51 }};
prove_print z3 {{ decrypt 0x2b7e151628aed2a6abf7158809cf4f3c 0x43b1cd7f598ece23881b00e3ed030688 == 0x30c81c46a35ce411e5fbc1191a0a52ef }};
prove_print z3 {{ decrypt 0x2b7e151628aed2a6abf7158809cf4f3c 0x7b0c785e27e8ad3f8223207104725dd4 == 0xf69f2445df4f9b17ad2b417be66c3710 }};

print "=== AES-128 ECB verification complete ===";